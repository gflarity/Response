var fs = require('fs');

debugger;

//load the config
var config = JSON.parse( fs.readFileSync( require.resolve('./config.json') ) );


module.exports = function( graphite_emitter, dispatch_emitter ) {
    
    var last_seen = new Date().getTime();    
    
    var on_nervous_heartbeat = function( value, timestamp ) {        
            
            //create some context, put whatever you want
            //from and graphite_event are required by convention
            var context = {
                from : 'nervous_hearbeat_watcher',
                graphite_event : { path : this.event, value : value, timestamp : timestamp }
            };
            
            //tell anyone who's interested that we've hit a condition we're watching for
            dispatch_emitter.emit( config.on_heartbeat, context ); 
    };
    graphite_emitter.on ( 'nervous.heartbeat', on_nervous_heartbeat ); 
       
};
